<button id="btn-open-room">Open Room</button>
<button id="btn-join-room">Join Room</button><hr>

<canvas id="ctx" width="500" height ="500" style="border:1px solid #000000"></canvas>




<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
<script src="https://rtcmulticonnection.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
<script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
<script>
    var chatText = document.getElementById("chat-text");
    var chatInput = document.getElementById("chat-input");
    var chatForm = document.getElementById("chat-form");
    
    var ctx = document.getElementById("ctx").getContext("2d");
    ctx.font="30px Arial";
    var socket = io("/", {transports:['websocket']});
    
    socket.on("newPosition",function(data){
        ctx.clearRect(0,0,500,500);
        for(var i = 0;i<data.player.length;i++){
            ctx.fillText(data.player[i].number,data.player[i].x,data.player[i].y);
        } 
        for(var i = 0;i<data.bullet.length;i++){
            ctx.fillRect(data.bullet[i].x-5,data.bullet[i].y-5,10,10);
        } 
    });
    
    
    document.onkeydown = function(event){
        if(event.keyCode ===68){
            socket.emit("keyPress",{inputId:"right",state:true});
        }else if(event.keyCode ===83){
            socket.emit("keyPress",{inputId:"down",state:true});
        }else if(event.keyCode ===65){
            socket.emit("keyPress",{inputId:"left",state:true});
        }else if(event.keyCode ===87){
            socket.emit("keyPress",{inputId:"up",state:true});
        }
    }
    document.onkeyup = function(event){
        if(event.keyCode ===68){
            socket.emit("keyPress",{inputId:"right",state:false});
        }else if(event.keyCode ===83){
            console.log("down")
            socket.emit("keyPress",{inputId:"down",state:false});
        }else if(event.keyCode ===65){
            socket.emit("keyPress",{inputId:"left",state:false});
        }else if(event.keyCode ===87){
            socket.emit("keyPress",{inputId:"up",state:false});
        }
    }
    
    
     socket.on('connect', function () {
         socket.on('disconnect', function () {
           // To intimate other clients about disconnection from server
           socket.emit('disconnect', {
             username: "Jake"
           });
         });
    })
    
    //voice chat
    var connection = new RTCMultiConnection();

// this line is VERY_important
connection.socketURL = 'https://localhost:2000/';

// all below lines are optional; however recommended.

connection.session = {
    audio: true,
    video: true
};

connection.sdpConstraints.mandatory = {
    OfferToReceiveAudio: true,
    OfferToReceiveVideo: true
};

connection.onstream = function(event) {
    document.body.appendChild( event.mediaElement );
};
    
    var predefinedRoomId = 'YOUR_Name';

document.getElementById('btn-open-room').onclick = function() {
    this.disabled = true;
    connection.open( predefinedRoomId );
};

document.getElementById('btn-join-room').onclick = function() {
    this.disabled = true;
    connection.join( predefinedRoomId );
};
    
</script>